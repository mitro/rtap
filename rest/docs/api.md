# Справочник API

## Адресация

Все URL API-ресурсов начинаются с префикса `/api`.

## Методы

Все API ресурсы могут иметь базовые CRUD методы, к примеру:
  - `GET /api/items` возвращает первую страницу коллекции ресурсов;
  - `POST /api/items` создает новый ресурс;
  - `GET /api/items/123` возвращает ресурс с `id=123`;
  - `PUT /api/items/123` обновляет ресурс с `id=123`;
  - `DELETE /api/items/123` удаляет ресурс с `id=123`.

Все запросы с телом (POST, PUT) должны иметь тип контента `application/json`.

Аутентификация производится путем передачи JWT-токена в заголовке запроса `X-Access-Token`.

## Пагинация

Коллекция ресурсов, возвращаемая методом `GET`, возвращается постранично (применяется *пагинация*). Пагинация контролируется двумя параметрами:
  - `page` определяет номер страницы (отсчет начинается с 1). Параметр необязательный. Значение по умолчанию равно 1.
  - `per_page` определяет количество элементов на странице. Параметр необязательный. Значение по умолчанию равно 20. Максимально допустимое значение равно 100.
   
Ответ со страницей коллекции имеет следующий формат:
```json
{
  "total": 1,
  "page": 1,
  "per_page": 20,
  "collection": [
    {
      "__v": 0,
      "_id": "55ec37acedce5c0016801f8e",
      "created": "2015-09-06T12:55:08.951Z",
      "full_name": "Dmitriy Melnik",
      "username": "mitro",
      "email": "mitro@mitro.me",
      "image_url": "/images/default_avatar.jpg"
    }
  ]
}
```

`total` содержит общее количество элементов запрошенной коллекции (с применением фильтров).
`page` содержит номер полученной страницы. `per_page` содержит количество элементов в полученной странице.
`collection` содержит элементы полученной страницы.

## Ошибки

Если запрос не удалось обработать, сервер возвращает ответ с ошибкой.
HTTP-код ошибки определяет ее тип:
  - 401: необходима аутентификация
  - 403: доступ запрещен
  - 404: ресурс не найден
  - 422: ошибка валидации
  - 500: внутренняя ошибка сервера

Все ответы с ошибками имеют одинаковый формат JSON:
```json
{
  "error": {
    "code": "not_found",
    "message": "Resource not found",
  }
}
```

Вы можете обрабатывать `code` автоматически или показывать пользователю `message` напрямую.

Ошибки валидации содержат детальную информацию о полях, не прошедших валидацию:
```json
{
  "error": {
    "code": "validation_failed",
    "message": "Validation failed",
    "fields": {
      "name": {
        "code": "required",
        "message": "Name is required"
      },
      "email": {
        "code": "bad_value",
        "message": "Email has invalid format"
      },
      "city": {
        "code": "longer_than_allowed",
        "message": "City is longer than allowed",
        "max_length": 255
      }
    }
  }
}
```

## Фильтрация и сортировка

Вы можете фильтровать и сортировать коллекции по полям, разрешенным в том или ином ресурсе.
Например: `GET /api/users?_name=vasya&order=-created`.

Параметр `order` определяет поле сортировки, `-` означает сортировку по убыванию.

Фильтрация по точному значению не является единственно возможной.
Также вы можете использовать следующие операторы, разделенные двумя подчеркиваниями:
`not`, `lt`, `lte`, `gt`, `gte`, `in`,
`not_in`, `startswith` (только для типа `string`). Например,
`GET /api/users?_age__gt=18&_age__lt=70&_status__in=active,disabled`.
